<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<title>צפייה בחשבון חשמל</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f4f7;
  padding: 40px;
}

.container {
  max-width: 650px;
  margin: auto;
  background: white;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  padding: 30px;
}

h1 {
  text-align: center;
  margin-bottom: 25px;
}

input[type="file"] {
  width: 100%;
  margin-bottom: 15px;
}

.card {
  background: #f9fafb;
  border-radius: 8px;
  padding: 12px 18px;
  margin-bottom: 12px;
  border-right: 5px solid #4f46e5;
}

.label {
  color: #6b7280;
  font-size: 14px;
  margin-bottom: 4px;
}

.field {
  width: 100%;
  font-size: 18px;
  font-weight: bold;
  border: none;
  background: transparent;
  outline: none;
}

button {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  background: #4f46e5;
  color: white;
  cursor: pointer;
  margin-top: 15px;
}
</style>
</head>

<body>

<div class="container">
<h1>פרטי חשבון חשמל</h1>

<input type="file" id="pdfInput" accept="application/pdf">

<div class="card">
  <div class="label">שם הלקוח</div>
  <input class="field" id="name">
</div>

<div class="card">
  <div class="label">כתובת האספקה</div>
  <input class="field" id="address">
</div>

<div class="card">
  <div class="label">מספר חשבון חוזה</div>
  <input class="field" id="contract">
</div>

<div class="card">
  <div class="label">סה״כ לתשלום (₪)</div>
  <input class="field" id="amount">
</div>

<div class="card">
  <div class="label">טלפון</div>
  <input class="field" id="phone">
</div>

<div class="card">
  <div class="label">מייל</div>
  <input class="field" id="email">
</div>

<div class="card">
  <div class="label">פרטי בנק</div>
  <input class="field" id="bank">
</div>

<button onclick="sendEmail()">שלח מייל</button>
</div>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

document.getElementById("pdfInput").addEventListener("change", async e => {
  const buffer = await e.target.files[0].arrayBuffer();
  const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;
  const page = await pdf.getPage(1);
  const text = (await page.getTextContent()).items.map(i=>i.str).join("\n");

  const block = text.match(/שם הלקוח וכתובת האספקה:\s*([\s\S]*?)\n\n/)?.[1] || "";
  const lines = block.split("\n").map(l=>l.trim()).filter(Boolean);

  document.getElementById("name").value =
    lines[0] || "";

  document.getElementById("address").value =
    lines[1] || "";

  document.getElementById("contract").value =
    text.match(/מספר חשבון חוזה:\s*(\d+)/)?.[1] || "";

  document.getElementById("amount").value =
    text.match(/([\d]+\.[\d]{2})\s*["״]?\s*ח?סה"?כ\s*לתשלום/)?.[1] || "";
});

function sendEmail(){
  const subject = encodeURIComponent("נתוני חשבון חשמל");
  const body = encodeURIComponent(
`שם: ${name.value}
כתובת: ${address.value}
חוזה: ${contract.value}
לתשלום: ${amount.value}

טלפון: ${phone.value}
מייל: ${email.value}
בנק: ${bank.value}`
  );

  window.open(
    `https://mail.google.com/mail/?view=cm&fs=1&su=${subject}&body=${body}`,
    "_blank"
  );
}
</script>

</body>
</html>
