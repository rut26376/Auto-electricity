<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<title>נתוני חשמל</title>
<link rel="icon" href="logo2.JPG" type="image/x-icon">
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<style>
:root {
  --primary: #0f172a;
  --secondary: #fbbf24;
  --bg: #f5f7fb;
  --card: #ffffff;
  --border: #e5e7eb;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: var(--bg);
  padding: 40px;
}

.container {
  max-width: 720px;
  margin: auto;
  background: var(--card);
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.08);
  padding: 32px;
}

.header {
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 30px;
}

.header img {
  max-height: 80px;
}

input[type="file"] {
  width: 100%;
  padding: 12px;
  border: 2px dashed var(--border);
  border-radius: 10px;
  margin-bottom: 24px;
  cursor: pointer;
}

.card {
  display: flex;
  flex-direction: column;
  background: #f9fafb;
  border-radius: 10px;
  padding: 14px 18px;
  margin-bottom: 14px;
  border-right: 6px solid var(--secondary);
}

.label {
  font-size: 13px;
  color: #6b7280;
  margin-bottom: 4px;
}

.field {
  font-size: 17px;
  font-weight: bold;
  border: none;
  background: transparent;
  outline: none;
  color: var(--primary);
}

button {
  width: 100%;
  margin-top: 24px;
  padding: 14px;
  font-size: 16px;
  font-weight: bold;
  border: none;
  border-radius: 10px;
  background: var(--primary);
  color: white;
  cursor: pointer;
}

button:hover {
  opacity: 0.9;
}
</style>
</head>

<body>

<div class="container">

  <div class="header">
    <img src="logo.JPG" alt="לוגו">
  </div>

  <input type="file" id="pdfInput" accept="application/pdf">

  <div class="card"><div class="label">שם העמותה</div><input class="field" id="name"></div>
  <div class="card"><div class="label">מספר העמותה</div><input class="field" id="association"></div>
  <div class="card"><div class="label">כתובת מלאה</div><input class="field" id="address"></div>
  <div class="card"><div class="label">מספר חשבון חוזה</div><input class="field" id="contract"></div>
  <div class="card"><div class="label">מספר מונה</div><input class="field" id="meter"></div>
  <div class="card"><div class="label">תעו״ז / רגיל</div><input class="field" id="tariff"></div>

  <div class="card"><div class="label">טלפון</div><input class="field" id="phone"></div>
  <div class="card"><div class="label">מייל</div><input class="field" id="email"></div>
<div class="card"><div class="label">שם הבנק</div><input class="field" id="bankName"></div>
<div class="card"><div class="label">מספר סניף</div><input class="field" id="bankBranch"></div>
<div class="card"><div class="label">מספר חשבון</div><input class="field" id="bankAccount"></div>
<div class="card"><div class="label">שם בעל החשבון</div><input class="field" id="bankHolder"></div>


  <button onclick="sendEmail()">שלח מייל</button>

</div>

  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

    document.getElementById("pdfInput").addEventListener("change", async e => {
      const buffer = await e.target.files[0].arrayBuffer();
      const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;

      let fullText = "";
      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const text = (await page.getTextContent()).items.map(i => i.str).join("\n");
        fullText += "\n" + text;
      }

      const lines = fullText.split("\n");

      // שם העמותה
      const nameMatch = fullText.match(/לכבוד:\s*\n\s*(.+)/);
      const orgName = nameMatch ? nameMatch[1].trim() : "";

      document.getElementById("name").value = orgName;

      // מספר עמותה
      document.getElementById("association").value =
        fullText.match(/עמותה\s*(\d+)/)?.[1] || "";
// חילוץ כתובת: שתי שורות לא ריקות אחרי שם העמותה
let addressLines = [];

for (let i = 0; i < lines.length; i++) {
  if (lines[i].trim() === orgName) {
    let j = i + 1;

    while (j < lines.length && addressLines.length < 2) {
      const line = lines[j].trim();
      if (line !== "") {
        addressLines.push(line);
      }
      j++;
    }

    break;
  }
}

document.getElementById("address").value = addressLines.join(" ");



      // מספר חוזה
      document.getElementById("contract").value =
        fullText.match(/מספר חשבון חוזה:\s*(\d+)/)?.[1] || "";

      // מספר מונה
      document.getElementById("meter").value =
        fullText.match(/מונה מספר:\s*(\d+)/)?.[1] || "";

      // תעו"ז / רגיל
      document.getElementById("tariff").value =
        /סוג הלקוח[\s\S]*?תעו/.test(fullText) ? 'תעו"ז' : 'רגיל';
    });

function sendEmail(){
  const subject = encodeURIComponent("נתוני חשבון חשמל");

  const body = encodeURIComponent(
`שם עמותה: ${document.getElementById("name").value}
מספר עמותה: ${document.getElementById("association").value}
כתובת: ${document.getElementById("address").value}
מספר חוזה: ${document.getElementById("contract").value}
מספר מונה: ${document.getElementById("meter").value}
תעריף: ${document.getElementById("tariff").value}

שם הבנק: ${document.getElementById("bankName").value}
סניף: ${document.getElementById("bankBranch").value}
חשבון: ${document.getElementById("bankAccount").value}
בעל החשבון: ${document.getElementById("bankHolder").value}

טלפון: ${document.getElementById("phone").value}
מייל: ${document.getElementById("email").value}`
  );

  window.open(
    `https://mail.google.com/mail/?view=cm&fs=1&su=${subject}&body=${body}`,
    "_blank"
  );
}

  </script>

</body>

</html>